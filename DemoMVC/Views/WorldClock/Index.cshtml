@model WorldClockViewModel
@{
    ViewData["Title"] = "ä¸–ç•Œæ™‚é˜";
}

<div class="world-clock-container">
    <!-- é é¢æ¨™é¡Œå€åŸŸ -->
    <header class="world-clock-header text-center mb-4">
        <h1 class="display-4 world-clock-title">ğŸŒ ä¸–ç•Œæ™‚é˜</h1>
        <p class="lead text-muted">å³æ™‚æŸ¥çœ‹ä¸–ç•Œå„åœ°æ™‚é–“</p>
    </header>

    <!-- ä¸»è¦æ™‚é–“é¡¯ç¤ºå€åŸŸ -->
    <div class="main-clock-section mb-5">
        <div class="main-clock-card" data-city="@Model.DefaultCity" data-timezone="@Model.TimeZoneId">
            <h2 class="main-city-name">@Model.DefaultCity</h2>
            <div class="main-time-display">@Model.CurrentTime</div>
            <small class="main-timezone-info">@Model.TimeZoneInfo</small>
            <div class="main-date-display">@Model.CurrentDate</div>
        </div>
    </div>

    <!-- å…¶ä»–åŸå¸‚æ™‚é–“ç¶²æ ¼ -->
    <div class="city-clocks-grid">
        @foreach (var city in Model.Cities.Where(c => c.Name != Model.DefaultCity))
        {
            <partial name="_TimeZoneCard" model="city" />
        }
    </div>

    <!-- é é¢åº•éƒ¨æ—¥æœŸé¡¯ç¤º -->
    <div class="world-clock-footer">
        <div class="date-display">
            <small class="text-muted">ç•¶å‰æ—¥æœŸï¼š</small>
            <span id="current-date">2024-01-01</span>
        </div>
        <div class="update-indicator">
            <small class="text-muted">
                <i class="bi bi-arrow-clockwise" id="update-icon"></i>
                å³æ™‚æ›´æ–°ä¸­
            </small>
        </div>
    </div>
</div>

<!-- è¼‰å…¥æç¤º -->
<div id="loading-overlay" class="loading-overlay">
    <div class="loading-spinner">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">è¼‰å…¥ä¸­...</span>
        </div>
        <p class="loading-text mt-3">æ­£åœ¨åŒæ­¥ä¸–ç•Œæ™‚é–“...</p>
    </div>
</div>

<!-- éŒ¯èª¤è¨Šæ¯é¡¯ç¤º -->
<div id="error-message" class="alert alert-danger d-none" role="alert">
    <h4 class="alert-heading">
        <i class="bi bi-exclamation-triangle"></i> 
        è¼‰å…¥å¤±æ•—
    </h4>
    <p class="mb-0">ç„¡æ³•è¼‰å…¥æ™‚å€è³‡æ–™ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šå¾Œé‡æ–°æ•´ç†é é¢ã€‚</p>
    <hr>
    <button type="button" class="btn btn-outline-danger btn-sm" onclick="location.reload()">
        <i class="bi bi-arrow-clockwise"></i> 
        é‡æ–°è¼‰å…¥
    </button>
</div>

@section Scripts {
    <script src="~/js/worldclock.js"></script>
    <script>
        // åˆå§‹åŒ–ä¸–ç•Œæ™‚é˜ï¼Œå‚³å…¥ä¼ºæœå™¨ç«¯çš„åŸå¸‚è³‡æ–™
        document.addEventListener('DOMContentLoaded', function() {
            const cities = @Html.Raw(Json.Serialize(Model.Cities));
            const defaultCity = '@Model.DefaultCity';
            
            // å¾ URL åƒæ•¸å–å¾—æŒ‡å®šçš„ä¸»è¦åŸå¸‚
            const urlParams = new URLSearchParams(window.location.search);
            const mainCityFromUrl = urlParams.get('main') || defaultCity;
            
            window.worldClockManager = new WorldClockManager(cities, mainCityFromUrl);
        });
    </script>
}

@section Styles {
    <link rel="stylesheet" href="~/css/worldclock.css" />
    <!-- Bootstrap Icons for UI enhancement -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
}
